## 过期策略

- **定时删除：**每个设置时间的 key 都需要创建一个定时器，到过期时间就会立即删除。

  ​		该策略可以立即清除过期的数据，对内存很友好；但是会占用大量的 CPU 资源去处理过期的数据，从而影响缓存的相应时间和吞吐量。

  

- **惰性删除：**只有当访问一个 key 时，才会判断该 key 是否过期，过期则清除。

  ​		最大化的节省 CPU 资源，但是对内存非常不友好。机端情况可能出现大量的过期 key 没有再次被访问，从而不会被清楚，占用大量内存



- **定期删除：**默认每隔 100ms，会扫描一定数量的数据库的 expires 字典中一定数量的key，并清楚其中已过期的key。该策略时前两者的一个这种方案。



**Redis中同时使用了 惰性过期 和 定时过期 两种过期策略。**



## 内存淘汰策略

指在 Redis 用于缓存的内存不足时，怎么处理需要新写入且需要申请额外空间的数据。

```properties
maxmemory-policy noeviction
```

- **noeviction：**

  ​		当内存不足以容纳新写入数据时，新写如操作会报错。

- **allkeys-lru：**

  ​		当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的 key。

- **allkeys-random：**

  ​		当内存不足以容纳新写入数据时，在键空间中，随机移除某个key。

- **volatile-lru：**

  ​		当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的 key。

- **volatile-random：**

  ​		当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，随机移除某个key。

- **volatile-ttl：**

  ​		当内存不足以容纳新写如数据时，在设置了过期时间的键空间中，有更早过期时间的 key 优先移除。



#### 总结

redis 的内存淘汰策略的选取并不会影响过期的 key 的处理。内存淘汰策略用于处理内存不足时需要申请额外空间的数据；过期策略用于处理过期的缓存数据。

