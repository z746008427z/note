## Znode

​		在结构上和标准稳健系统非常想死，都是采用树形层级结构。zk 树中每个节点被称为 Znode。和文件系统的目录树一样，zk树中每个节点可以拥有子节点。但也有不同之处。



#### 引用方式

​		Znode 通过路径引用，路径必须是绝对的，因此他们必须由斜杠字符来开头。除此之外，他们必须是唯一的，就是每一个路径只有一个表示，因此路径不能改变。zk中，路径由 Unicode 字符串组成，并且有一些限制。字符串 /zookeeper 用以保存管理信息，比如关键配额信息。



#### Znode 结构

​		zk 命名空间中的 Znode，兼具文件和目录两种特点。即像文件一样维护着数据、元信息、ACL、时间戳等数据结构，又像目录一样可以作为路径标识的一部分。图中每一个节点称为一个Znode。

##### Znode组成

1. **stat**：状态信息，描述Znode版本、权限等信息
2. **data**：与该Znode关联的数据
3. **children**：该Znode下的子节点

​		zk 可以管来拿一些数据，但并没有被设计为常规的数据库或者大数据存储，它用来管理调度数据，比如分布式应用中的配置文件信息、状态信息、汇集位置等等。



#### 数据访问

​		zk中每个节点存储的数据要被原子性操作。也就是说读操作将获取与节点相关的所有数据，写操作也将替换掉节点的所有数据。每一个节点都拥有自己的 ACL（访问控制列表）



#### 节点类型

​		节点类型在创建时即被确定，并且不能改变。

- **临时节点**：生命周期依赖于创建它们的会话。会话（session）结束，临时节点将被自动删除，也可以手动删除。每个临时Znode会绑定到一个客户端会话，但是对所有客户端可见。zk的临时节点不允许拥有子节点。
- **永久节点**：该节点生命周期不依赖于会话，并且只在客户端显示执行删除操作的时候，它们才能被删除。



#### 顺序节点

​		当创建 Znode 的时候，可以请求再 zk 的路径结尾添加一个递增的计数。这个计数对此节点的父节点来说是唯一的。格式为 "%10d"（10位数字，没有数值的数位用0补充，例'0000000001'），当计数值大于 2^32-1 时，计数器溢出。



#### 观察

​		客户端可以在节点上设置 watch，我们称之为监视器。当节点状态发生改变时将会出发 watch 所对应的操作。当watch被触发时，zk将会向客户端发送且仅发送一条通知，因为watch只能被触发一次，这样可以减少网络流量。



## zk的时间

​		zk节点状态改变得每一个操作都将使节点接受到一个 Zxid 格式的时间戳，并且这个时间戳全局有序。也就是说，每个对节点状态的改变都将产生一个唯一的 Zxid。如果Zxid1的值小于Zxid2的值，那么Zxid1所对应的事件发生在Zxid2所对应的事件之前。实际上，ZooKeeper的每个节点维护者三个Zxid值，为别为：cZxid、mZxid、pZxid。

































