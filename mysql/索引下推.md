## 索引下推

#### 概述

- 不适用索引下推条件下优化时存储引擎通过索引检索到数据，然后返回给mysql服务器，服务器然后判断数据是否符合条件。
- 当使用索引条件下推优化时，如果存在某些被索引的列的判断条件时，mysql服务器将这一部分判断条件传递给存储引擎，然后由存储引擎通过判断索引是否符合mysql服务器传递的条件，只有当索引符合条件时才会将数据检索出来返回给mysql服务器。
- 5.6版本前没有这个优化。



**索引条件下推优化可以减少存储引擎查询基础表的次数，也可以减少mysql服务器从存储引擎接收数据的次数。**



#### 使用条件

1. 需要整表扫描的情况。
2. 对于 InnoDB 引擎只适用于二级索引。
3. 引用子查询的条件不能下推。
4. 调用存储过程的条件不能下推，存储引擎无法调用位于mysql服务器中的存储过程。
5. 触发条件不能下推。



#### 工作过程

**不适用索引下推优化时的查询过程**

- 获取下一行，首先读取索引信息，然后根据索引将整行数据读取出来。然后通过where条件判断当前数据是否符合条件。符合返回数据。

**使用索引条件下推优化查询过程**

- 获取下一行索引信息。检查索引中存储的列信息是否符合索引条件，如何符合将整行数据读取出来，如果不符合跳过读取下一行。判断慈航数据是否符合要求，符合要求返回数据。



**如果使用了索引条件下推，Extra会显示 using index condition**



#### 总结

- 索引下推在**非主键索引**上的优化，可以有效减少回表的次数，大大提升了查询的效率。

- 充分利用索引中的数据，尽量在查询整行之前充分过滤掉无效的数据。

- 关闭索引下推可以使用如下命令，默认开始

```sql
set optimizer_switch = 'index_condition_pushdown = off';
```



引用：

> https://juejin.cn/post/6844904017332535304

